"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(e,t){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):window.mediumZoom=t()}(0,function(){var e=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n])}return e},t=function(e){return"IMG"===e.tagName},o=function(e){return e&&1===e.nodeType},n=function(e){return".svg"===(e.currentSrc||e.src).substr(-4).toLowerCase()},i=function(e){try{return Array.isArray(e)?e.filter(t):function(e){return NodeList.prototype.isPrototypeOf(e)}(e)?[].slice.call(e).filter(t):o(e)?[e].filter(t):"string"==typeof e?[].slice.call(document.querySelectorAll(e)).filter(t):[]}catch(e){throw new TypeError("The provided selector is invalid.\nExpects a CSS selector, a Node element, a NodeList or an array.\nSee: https://github.com/francoischalifour/medium-zoom")}},r=function(t,o){var n=e({bubbles:!1,cancelable:!1,detail:void 0},o);if("function"==typeof window.CustomEvent)return new CustomEvent(t,n);var i=document.createEvent("CustomEvent");return i.initCustomEvent(t,n.bubbles,n.cancelable,n.detail),i};return function(e,t){void 0===t&&(t={});var o=t.insertAt;if(e&&"undefined"!=typeof document){var n=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===o&&n.firstChild?n.insertBefore(i,n.firstChild):n.appendChild(i),i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e))}}(".medium-zoom-overlay{position:fixed;top:0;right:0;bottom:0;left:0;opacity:0;transition:opacity .3s;will-change:opacity}.medium-zoom--opened .medium-zoom-overlay{cursor:pointer;cursor:zoom-out;opacity:1}.medium-zoom-image{cursor:pointer;cursor:zoom-in;transition:transform .3s cubic-bezier(.2,0,.2,1)}.medium-zoom-image--hidden{visibility:hidden}.medium-zoom-image--opened{position:relative;cursor:pointer;cursor:zoom-out;will-change:transform}"),function t(d){var m=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=window.Promise||function(e){function t(){}e(t,t)},c=function(){for(var e=arguments.length,t=Array(e),o=0;o<e;o++)t[o]=arguments[o];var n=t.reduce(function(e,t){return[].concat(e,i(t))},[]);return n.filter(function(e){return-1===f.indexOf(e)}).forEach(function(e){f.push(e),e.classList.add("medium-zoom-image")}),p.forEach(function(e){var t=e.type,o=e.listener,i=e.options;n.forEach(function(e){e.addEventListener(t,o,i)})}),b},l=function(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).target,i=function(){var t={width:document.documentElement.clientWidth,height:document.documentElement.clientHeight,left:0,top:0,right:0,bottom:0},i=void 0,r=void 0;if(h.container)if(h.container instanceof Object)i=(t=e({},t,h.container)).width-t.left-t.right-2*h.margin,r=t.height-t.top-t.bottom-2*h.margin;else{var d=(o(h.container)?h.container:document.querySelector(h.container)).getBoundingClientRect(),m=d.width,a=d.height,c=d.left,l=d.top;t=e({},t,{width:m,height:a,left:c,top:l})}i=i||t.width-2*h.margin,r=r||t.height-2*h.margin;var u=z.zoomedHd||z.original,s=n(u)?i:u.naturalWidth||i,f=n(u)?r:u.naturalHeight||r,p=u.getBoundingClientRect(),g=p.top,v=p.left,y=p.width,b=p.height,E=Math.min(s,i)/y,w=Math.min(f,r)/b,L=Math.min(E,w),H="scale("+L+") translate3d("+((i-y)/2-v+h.margin+t.left)/L+"px, "+((r-b)/2-g+h.margin+t.top)/L+"px, 0)";z.zoomed.style.transform=H,z.zoomedHd&&(z.zoomedHd.style.transform=H)};return new a(function(e){if(t&&-1===f.indexOf(t))e(b);else if(z.zoomed)e(b);else{if(t)z.original=t;else{if(!(f.length>0))return void e(b);var n=f;z.original=n[0]}if(z.original.dispatchEvent(r("medium-zoom:open",{detail:{zoom:b}})),v=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,g=!0,z.zoomed=function(e){var t=e.getBoundingClientRect(),o=t.top,n=t.left,i=t.width,r=t.height,d=e.cloneNode(),m=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,a=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0;return d.removeAttribute("id"),d.style.position="absolute",d.style.top=o+m+"px",d.style.left=n+a+"px",d.style.width=i+"px",d.style.height=r+"px",d.style.transform="",d}(z.original),document.body.appendChild(y),h.template){var d=o(h.template)?h.template:document.querySelector(h.template);z.template=document.createElement("div"),z.template.appendChild(d.content.cloneNode(!0)),document.body.appendChild(z.template)}if(document.body.appendChild(z.zoomed),window.requestAnimationFrame(function(){document.body.classList.add("medium-zoom--opened")}),z.original.classList.add("medium-zoom-image--hidden"),z.zoomed.classList.add("medium-zoom-image--opened"),z.zoomed.addEventListener("click",u),z.zoomed.addEventListener("transitionend",function t(){g=!1,z.zoomed.removeEventListener("transitionend",t),z.original.dispatchEvent(r("medium-zoom:opened",{detail:{zoom:b}})),e(b)}),z.original.getAttribute("data-zoom-src")){z.zoomedHd=z.zoomed.cloneNode(),z.zoomedHd.removeAttribute("srcset"),z.zoomedHd.removeAttribute("sizes"),z.zoomedHd.src=z.zoomed.getAttribute("data-zoom-src"),z.zoomedHd.onerror=function(){clearInterval(m),console.warn("Unable to reach the zoom image target "+z.zoomedHd.src),z.zoomedHd=null,i()};var m=setInterval(function(){z.zoomedHd.complete&&(clearInterval(m),z.zoomedHd.classList.add("medium-zoom-image--opened"),z.zoomedHd.addEventListener("click",u),document.body.appendChild(z.zoomedHd),i())},10)}else if(z.original.hasAttribute("srcset")){z.zoomedHd=z.zoomed.cloneNode(),z.zoomedHd.removeAttribute("sizes");var a=z.zoomedHd.addEventListener("load",function(){z.zoomedHd.removeEventListener("load",a),z.zoomedHd.classList.add("medium-zoom-image--opened"),z.zoomedHd.addEventListener("click",u),document.body.appendChild(z.zoomedHd),i()})}else i()}})},u=function(){return new a(function(e){!g&&z.original?(g=!0,document.body.classList.remove("medium-zoom--opened"),z.zoomed.style.transform="",z.zoomedHd&&(z.zoomedHd.style.transform=""),z.template&&(z.template.style.transition="opacity 150ms",z.template.style.opacity=0),z.original.dispatchEvent(r("medium-zoom:close",{detail:{zoom:b}})),z.zoomed.addEventListener("transitionend",function t(){z.original.classList.remove("medium-zoom-image--hidden"),document.body.removeChild(z.zoomed),z.zoomedHd&&document.body.removeChild(z.zoomedHd),document.body.removeChild(y),z.zoomed.classList.remove("medium-zoom-image--opened"),z.template&&document.body.removeChild(z.template),g=!1,z.zoomed.removeEventListener("transitionend",t),z.original.dispatchEvent(r("medium-zoom:closed",{detail:{zoom:b}})),z.original=null,z.zoomed=null,z.zoomedHd=null,z.template=null,e(b)})):e(b)})},s=function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).target;return z.original?u():l({target:e})},f=[],p=[],g=!1,v=0,h=m,z={original:null,zoomed:null,zoomedHd:null,template:null};"[object Object]"===Object.prototype.toString.call(d)?h=d:(d||"string"==typeof d)&&c(d);var y=function(e){var t=document.createElement("div");return t.classList.add("medium-zoom-overlay"),t.style.background=e,t}((h=e({margin:0,background:"#fff",scrollOffset:40,container:null,template:null},h)).background);document.addEventListener("click",function(e){var t=e.target;t!==y?-1!==f.indexOf(t)&&s({target:t}):u()}),document.addEventListener("keyup",function(e){27===(e.keyCode||e.which)&&u()}),document.addEventListener("scroll",function(){if(!g&&z.original){var e=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0;Math.abs(v-e)>h.scrollOffset&&setTimeout(u,150)}}),window.addEventListener("resize",u);var b={open:l,close:u,toggle:s,update:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t;if(t.background&&(y.style.background=t.background),t.container&&t.container instanceof Object&&(n.container=e({},h.container,t.container)),t.template){var i=o(t.template)?t.template:document.querySelector(t.template);n.template=i}return h=e({},h,n),f.forEach(function(e){e.dispatchEvent(r("medium-zoom:update",{detail:{zoom:b}}))}),b},clone:function(){var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t(e({},h,o))},attach:c,detach:function(){for(var e=arguments.length,t=Array(e),o=0;o<e;o++)t[o]=arguments[o];z.zoomed&&u();var n=t.length>0?t.reduce(function(e,t){return[].concat(e,i(t))},[]):f;return n.forEach(function(e){e.classList.remove("medium-zoom-image"),e.dispatchEvent(r("medium-zoom:detach",{detail:{zoom:b}}))}),f=f.filter(function(e){return-1===n.indexOf(e)}),b},on:function(e,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return f.forEach(function(n){n.addEventListener("medium-zoom:"+e,t,o)}),p.push({type:"medium-zoom:"+e,listener:t,options:o}),b},off:function(e,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return f.forEach(function(n){n.removeEventListener("medium-zoom:"+e,t,o)}),p=p.filter(function(o){return!(o.type==="medium-zoom:"+e&&o.listener.toString()===t.toString())}),b},getOptions:function(){return h},getImages:function(){return f},getZoomedImage:function(){return z.original}};return b}});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInBhcnRzL21lZGl1bS16b29tLmpzIl0sIm5hbWVzIjpbImdsb2JhbCIsImZhY3RvcnkiLCJleHBvcnRzIiwiX3R5cGVvZiIsIm1vZHVsZSIsImRlZmluZSIsImFtZCIsIndpbmRvdyIsIm1lZGl1bVpvb20iLCJfZXh0ZW5kcyIsImFzc2lnbiIsInRhcmdldCIsImkiLCJhcmd1bWVudHMiLCJsZW5ndGgiLCJzb3VyY2UiLCJrZXkiLCJPYmplY3QiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiLCJub2RlIiwidGFnTmFtZSIsImlzTm9kZSIsInNlbGVjdG9yIiwibm9kZVR5cGUiLCJpc1N2ZyIsImltYWdlIiwiY3VycmVudFNyYyIsInNyYyIsInN1YnN0ciIsInRvTG93ZXJDYXNlIiwiZ2V0SW1hZ2VzRnJvbVNlbGVjdG9yIiwiaXNQcm90b3R5cGVPZiIsIkFycmF5IiwiaXNBcnJheSIsIk5vZGVMaXN0IiwiaXNOb2RlTGlzdCIsInNsaWNlIiwiZmlsdGVyIiwiaXNTdXBwb3J0ZWQiLCJkb2N1bWVudCIsIlR5cGVFcnJvciIsIm92ZXJsYXkiLCJ0eXBlIiwicGFyYW1zIiwiZXZlbnRQYXJhbXMiLCJidWJibGVzIiwiY2FuY2VsYWJsZSIsImNsb25lVGFyZ2V0IiwiX3RlbXBsYXRlJGdldEJvdW5kaW5nIiwibGVmdCIsImhlaWdodCIsImN1c3RvbUV2ZW50IiwiaW5pdEN1c3RvbUV2ZW50IiwiZGV0YWlsIiwiem9vbSIsInJlZiIsImluc2VydEF0IiwiYWN0aXZlIiwidGVtcGxhdGUiLCJoZWFkIiwiZ2V0RWxlbWVudHNCeVRhZ05hbWUiLCJyZXNvbHZlIiwiY3JlYXRlRWxlbWVudCIsInN0eWxlIiwiaXNBbmltYXRpbmciLCJjbGFzc0xpc3QiLCJyZW1vdmUiLCJmaXJzdENoaWxkIiwiYXBwZW5kQ2hpbGQiLCJjc3NUZXh0IiwidHJhbnNpdGlvbiIsImNyZWF0ZVRleHROb2RlIiwiY3NzIiwicGFnZVhPZmZzZXQiLCJjbG9uZSIsInJlbW92ZUF0dHJpYnV0ZSIsInVuZGVmaW5lZCIsInBvc2l0aW9uIiwiUHJvbWlzZSIsImZuIiwidG9wIiwiTWF0aCIsInNjcm9sbFRvcCIsInNldFRpbWVvdXQiLCJzZWxlY3RvcnMiLCJfbGVuIiwiX2tleSIsIm5ld0ltYWdlcyIsInJlZHVjZSIsImltYWdlc0FjY3VtdWxhdG9yIiwiY3VycmVudFNlbGVjdG9yIiwiX2hhbmRsZUtleVVwIiwiY29uY2F0IiwiZXZlbnQiLCJjbG9zZSIsIm5ld0ltYWdlIiwiaW1hZ2VzIiwiaW5kZXhPZiIsImZvckVhY2giLCJwdXNoIiwidXBkYXRlIiwiZXZlbnRMaXN0ZW5lcnMiLCJvcHRpb25zIiwiX3JlZiIsImxpc3RlbmVyIiwiYmFja2dyb3VuZCIsIm9wZW4iLCJfYW5pbWF0ZSIsImRldGFjaCIsImNvbnRhaW5lciIsIndpZHRoIiwiX2xlbjIiLCJfa2V5MiIsImNsaWVudEhlaWdodCIsInpvb21lZCIsInZpZXdwb3J0V2lkdGgiLCJpbWFnZXNUb0RldGFjaCIsInpvb21PcHRpb25zIiwicmlnaHQiLCJtYXJnaW4iLCJkaXNwYXRjaEV2ZW50IiwiY3JlYXRlQ3VzdG9tRXZlbnQiLCJib3R0b20iLCJfem9vbUNvbnRhaW5lciRnZXRCb3UiLCJnZXRCb3VuZGluZ0NsaWVudFJlY3QiLCJfd2lkdGgiLCJfaGVpZ2h0IiwiX2xlZnQiLCJfdG9wIiwib3JpZ2luYWwiLCJhZGRFdmVudExpc3RlbmVyIiwiem9vbVRhcmdldCIsIm5hdHVyYWxXaWR0aCIsIm5hdHVyYWxIZWlnaHQiLCJ2aWV3cG9ydEhlaWdodCIsIl96b29tVGFyZ2V0JGdldEJvdW5kaSIsInNjYWxlWCIsIm1pbiIsInRyYW5zZm9ybSIsInNjYWxlIiwiem9vbWVkSGQiLCJldmVudExpc3RlbmVyIiwiX2ltYWdlcyIsInpvb21Db250YWluZXIiLCJib2R5IiwicGFnZVlPZmZzZXQiLCJkb2N1bWVudEVsZW1lbnQiLCJzY3JvbGxMZWZ0IiwiY3JlYXRlT3ZlcmxheSIsInF1ZXJ5U2VsZWN0b3IiLCJjb250ZW50IiwiY2xvbmVOb2RlIiwicmVxdWVzdEFuaW1hdGlvbkZyYW1lIiwiYWRkIiwiX2hhbmRsZU9wZW5FbmQiLCJfcmVmMiIsImdldEF0dHJpYnV0ZSIsImNsZWFySW50ZXJ2YWwiLCJnZXRab29tVGFyZ2V0U2l6ZSIsInNjYWxlWSIsInRyYW5zbGF0ZVkiLCJjb21wbGV0ZSIsImxvYWRFdmVudExpc3RlbmVyIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsIl9oYW5kbGVDbG9zZUVuZCIsInJlbW92ZUNoaWxkIiwidG9nZ2xlIiwib25lcnJvciIsImNvbnNvbGUiLCJ0b1N0cmluZyIsImF0dGFjaCIsInNjcm9sbE9mZnNldCIsImtleUNvZGUiLCJ3aGljaCIsIkN1c3RvbUV2ZW50IiwiY3VycmVudFNjcm9sbCIsIm5ld09wdGlvbnMiLCJfaGFuZGxlQ2xpY2siLCJvbiIsImdldE9wdGlvbnMiLCJnZXRJbWFnZXMiXSwibWFwcGluZ3MiOiIrUEFDQSxTQUFVQSxFQUFRQyxHQUNLLFlBQW5CLG9CQUFPQyxRQUFQLFlBQUFDLFFBQU9ELFdBQTBDLG9CQUFYRSxPQUF5QkEsT0FBT0YsUUFBVUQsSUFBOEIsbUJBQVhJLFFBQXlCQSxPQUFPQyxJQUFNRCxPQUFPSixHQUFXTSxPQUFPQyxXQUFhUCxJQURuTCxDQUFBLEVBRVcsV0FGVixJQUFBUSxFQUFpQlIsT0FBakJTLFFBQTBCLFNBQUFDLEdBQ3ZCLElBQU9ULElBQUFBLEVBQVAsRUFBQVUsRUFBQUMsVUFBQUMsT0FBQUYsSUFBQSxDQURKLElBRVdHLEVBQUFGLFVBQVdELEdBQ2xCLElBQUEsSUFBQUksS0FBQUQsRUFLVUUsT0FBT0MsVUFBVUMsZUFBZUMsS0FBS0wsRUFBUUMsS0FKbkRQLEVBQVdRLEdBQU9QLEVBQVBNLElBR1gsT0FBS0wsR0FFREEsRUFBQSxTQUFBVSxHQUNELE1BQUEsUUFBQUEsRUFBQUMsU0FOUEMsRUFBQSxTQUFBQyxHQWtCRSxPQUFPQSxHQUFrQyxJQUF0QkEsRUFBU0MsVUFONUJDLEVBQVlKLFNBQVlLLEdBVXhCLE1BQTJDLFVBWDdDQSxF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LEVBUVYsT0FQTW5FLEVBQVE2QyxRQUFBLFNBQUF6RSxHQUNONkIsRUFBSVcsVUFBRVgsT0FBQUEscUJBREE3QixFQUFBK0YsY0FBQUMsRUFBQSxxQkFBQSxDQURWcEUsT0FBQSxDQURGQyxLQUFBQSxRQVNFb0IsRUFBUXNCLEVBQUEzRCxPQUFBLFNBQWlCWixHQUN2QjZFLE9BQWtDM0YsSUFBM0J5RyxFQUFheEcsUUFBVmEsS0FEaEI2QixHQXdOTTRILEdBcE5JLFNBQVlSLEVBQVRsRSxHQUNYLElBQUtGLEVBQVczRixVQUFVQyxPQUFRd0UsUUFBN0JSLElBQTZCUSxVQUFZcEQsR0FBdUJzRCxVQUFPRCxHQUFNQyxHQU1sRixPQUxFRixFQUFBQSxRQUFBLFNBQWtCekUsR0FDbkJjLEVBQUF5RyxpQkFBQSxlQUFBeEYsRUFBQThELEVBQUFGLEtBQ0RELEVBQWdCakIsS0FBQUEsQ0FDZDFDLEtBQU8sZUFBVStDLEVBQ2hCZSxTQUZIQSxFQUdBakIsUUFBVWxELElBRVA2RCxHQTRNRzNELElBMU1JLFNBQVdrSCxFQUFJakQsR0FKekIsSUFBQUYsRUFBQTNGLFVBQUFDLE9BQUEsUUFBQWdFLElBQUFqRSxVQUFBLEdBQUFBLFVBQUEsR0FBQSxHQVVHLE9BSkgwRixFQUFBQSxRQUFlSCxTQUFRekUsR0FDckJBLEVBQVEwSSxvQkFBUixlQUFBekgsRUFBQThELEVBQUFGLEtBQUFELEVBQTBERSxFQUExRGxFLE9BQUEsU0FBQXdHLEdBQ0F0RCxRQUFVVyxFQUFReEQsT0FBQSxlQUFnQkEsR0FBQW1HLEVBQUFyQyxTQUFBaUUsYUFBQWpFLEVBQUFpRSxjQUFsQ25ILEdBdU1HNkgsV0F4Q0dyQixXQUNGLE9BQUF6QyxHQWdJTitELFVBOUhleEMsV0FDUG5GLE9BQUFBLEdBcUNKTyxlQThDZSxXQWpGWDJDLE9BQUFBLEVBQVFzQixXQXFDWnhFLE9BQUFBIiwiZmlsZSI6InBhcnRzL21lZGl1bS16b29tLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qISBtZWRpdW0tem9vbSAxLjAuNCB8IE1JVCBMaWNlbnNlIHwgaHR0cHM6Ly9naXRodWIuY29tL2ZyYW5jb2lzY2hhbGlmb3VyL21lZGl1bS16b29tICovXHJcbihmdW5jdGlvbihnbG9iYWwsIGZhY3RvcnkpIHtcclxuICAgIHR5cGVvZiBleHBvcnRzID09PSBcIm9iamVjdFwiICYmIHR5cGVvZiBtb2R1bGUgIT09IFwidW5kZWZpbmVkXCIgPyBtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkoKSA6IHR5cGVvZiBkZWZpbmUgPT09IFwiZnVuY3Rpb25cIiAmJiBkZWZpbmUuYW1kID8gZGVmaW5lKGZhY3RvcnkpIDogd2luZG93Lm1lZGl1bVpvb20gPSBmYWN0b3J5KCk7XHJcbiAgfSkodGhpcywgZnVuY3Rpb24oKSB7XHJcbiAgICBcInVzZSBzdHJpY3RcIjtcclxuICAgIHZhciBfZXh0ZW5kcyA9IE9iamVjdC5hc3NpZ24gfHwgZnVuY3Rpb24odGFyZ2V0KSB7XHJcbiAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpXTtcclxuICAgICAgICBmb3IgKHZhciBrZXkgaW4gc291cmNlKSB7XHJcbiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHNvdXJjZSwga2V5KSkge1xyXG4gICAgICAgICAgICB0YXJnZXRba2V5XSA9IHNvdXJjZVtrZXldO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gdGFyZ2V0O1xyXG4gICAgfTtcclxuICAgIHZhciBpc1N1cHBvcnRlZCA9IGZ1bmN0aW9uIGlzU3VwcG9ydGVkKG5vZGUpIHtcclxuICAgICAgcmV0dXJuIG5vZGUudGFnTmFtZSA9PT0gXCJJTUdcIjtcclxuICAgIH07XHJcbiAgICB2YXIgaXNOb2RlTGlzdCA9IGZ1bmN0aW9uIGlzTm9kZUxpc3Qoc2VsZWN0b3IpIHtcclxuICAgICAgcmV0dXJuIE5vZGVMaXN0LnByb3RvdHlwZS5pc1Byb3RvdHlwZU9mKHNlbGVjdG9yKTtcclxuICAgIH07XHJcbiAgICB2YXIgaXNOb2RlID0gZnVuY3Rpb24gaXNOb2RlKHNlbGVjdG9yKSB7XHJcbiAgICAgIHJldHVybiBzZWxlY3RvciAmJiBzZWxlY3Rvci5ub2RlVHlwZSA9PT0gMTtcclxuICAgIH07XHJcbiAgICB2YXIgaXNTdmcgPSBmdW5jdGlvbiBpc1N2ZyhpbWFnZSkge1xyXG4gICAgICB2YXIgc291cmNlID0gaW1hZ2UuY3VycmVudFNyYyB8fCBpbWFnZS5zcmM7XHJcbiAgICAgIHJldHVybiBzb3VyY2Uuc3Vic3RyKC00KS50b0xvd2VyQ2FzZSgpID09PSBcIi5zdmdcIjtcclxuICAgIH07XHJcbiAgICB2YXIgZ2V0SW1hZ2VzRnJvbVNlbGVjdG9yID0gZnVuY3Rpb24gZ2V0SW1hZ2VzRnJvbVNlbGVjdG9yKHNlbGVjdG9yKSB7XHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoc2VsZWN0b3IpKSB7XHJcbiAgICAgICAgICByZXR1cm4gc2VsZWN0b3IuZmlsdGVyKGlzU3VwcG9ydGVkKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGlzTm9kZUxpc3Qoc2VsZWN0b3IpKSB7XHJcbiAgICAgICAgICByZXR1cm4gW10uc2xpY2UuY2FsbChzZWxlY3RvcikuZmlsdGVyKGlzU3VwcG9ydGVkKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGlzTm9kZShzZWxlY3RvcikpIHtcclxuICAgICAgICAgIHJldHVybiBbIHNlbGVjdG9yIF0uZmlsdGVyKGlzU3VwcG9ydGVkKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHR5cGVvZiBzZWxlY3RvciA9PT0gXCJzdHJpbmdcIikge1xyXG4gICAgICAgICAgcmV0dXJuIFtdLnNsaWNlLmNhbGwoZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChzZWxlY3RvcikpLmZpbHRlcihpc1N1cHBvcnRlZCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBbXTtcclxuICAgICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIlRoZSBwcm92aWRlZCBzZWxlY3RvciBpcyBpbnZhbGlkLlxcblwiICsgXCJFeHBlY3RzIGEgQ1NTIHNlbGVjdG9yLCBhIE5vZGUgZWxlbWVudCwgYSBOb2RlTGlzdCBvciBhbiBhcnJheS5cXG5cIiArIFwiU2VlOiBodHRwczovL2dpdGh1Yi5jb20vZnJhbmNvaXNjaGFsaWZvdXIvbWVkaXVtLXpvb21cIik7XHJcbiAgICAgIH1cclxuICAgIH07XHJcbiAgICB2YXIgY3JlYXRlT3ZlcmxheSA9IGZ1bmN0aW9uIGNyZWF0ZU92ZXJsYXkoYmFja2dyb3VuZCkge1xyXG4gICAgICB2YXIgb3ZlcmxheSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgIG92ZXJsYXkuY2xhc3NMaXN0LmFkZChcIm1lZGl1bS16b29tLW92ZXJsYXlcIik7XHJcbiAgICAgIG92ZXJsYXkuc3R5bGUuYmFja2dyb3VuZCA9IGJhY2tncm91bmQ7XHJcbiAgICAgIHJldHVybiBvdmVybGF5O1xyXG4gICAgfTtcclxuICAgIHZhciBjbG9uZVRhcmdldCA9IGZ1bmN0aW9uIGNsb25lVGFyZ2V0KHRlbXBsYXRlKSB7XHJcbiAgICAgIHZhciBfdGVtcGxhdGUkZ2V0Qm91bmRpbmcgPSB0ZW1wbGF0ZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSwgdG9wID0gX3RlbXBsYXRlJGdldEJvdW5kaW5nLnRvcCwgbGVmdCA9IF90ZW1wbGF0ZSRnZXRCb3VuZGluZy5sZWZ0LCB3aWR0aCA9IF90ZW1wbGF0ZSRnZXRCb3VuZGluZy53aWR0aCwgaGVpZ2h0ID0gX3RlbXBsYXRlJGdldEJvdW5kaW5nLmhlaWdodDtcclxuICAgICAgdmFyIGNsb25lID0gdGVtcGxhdGUuY2xvbmVOb2RlKCk7XHJcbiAgICAgIHZhciBzY3JvbGxUb3AgPSB3aW5kb3cucGFnZVlPZmZzZXQgfHwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFRvcCB8fCBkb2N1bWVudC5ib2R5LnNjcm9sbFRvcCB8fCAwO1xyXG4gICAgICB2YXIgc2Nyb2xsTGVmdCA9IHdpbmRvdy5wYWdlWE9mZnNldCB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsTGVmdCB8fCBkb2N1bWVudC5ib2R5LnNjcm9sbExlZnQgfHwgMDtcclxuICAgICAgY2xvbmUucmVtb3ZlQXR0cmlidXRlKFwiaWRcIik7XHJcbiAgICAgIGNsb25lLnN0eWxlLnBvc2l0aW9uID0gXCJhYnNvbHV0ZVwiO1xyXG4gICAgICBjbG9uZS5zdHlsZS50b3AgPSB0b3AgKyBzY3JvbGxUb3AgKyBcInB4XCI7XHJcbiAgICAgIGNsb25lLnN0eWxlLmxlZnQgPSBsZWZ0ICsgc2Nyb2xsTGVmdCArIFwicHhcIjtcclxuICAgICAgY2xvbmUuc3R5bGUud2lkdGggPSB3aWR0aCArIFwicHhcIjtcclxuICAgICAgY2xvbmUuc3R5bGUuaGVpZ2h0ID0gaGVpZ2h0ICsgXCJweFwiO1xyXG4gICAgICBjbG9uZS5zdHlsZS50cmFuc2Zvcm0gPSBcIlwiO1xyXG4gICAgICByZXR1cm4gY2xvbmU7XHJcbiAgICB9O1xyXG4gICAgdmFyIGNyZWF0ZUN1c3RvbUV2ZW50ID0gZnVuY3Rpb24gY3JlYXRlQ3VzdG9tRXZlbnQodHlwZSwgcGFyYW1zKSB7XHJcbiAgICAgIHZhciBldmVudFBhcmFtcyA9IF9leHRlbmRzKHtcclxuICAgICAgICBidWJibGVzOiBmYWxzZSxcclxuICAgICAgICBjYW5jZWxhYmxlOiBmYWxzZSxcclxuICAgICAgICBkZXRhaWw6IHVuZGVmaW5lZFxyXG4gICAgICB9LCBwYXJhbXMpO1xyXG4gICAgICBpZiAodHlwZW9mIHdpbmRvdy5DdXN0b21FdmVudCA9PT0gXCJmdW5jdGlvblwiKSB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBDdXN0b21FdmVudCh0eXBlLCBldmVudFBhcmFtcyk7XHJcbiAgICAgIH1cclxuICAgICAgdmFyIGN1c3RvbUV2ZW50ID0gZG9jdW1lbnQuY3JlYXRlRXZlbnQoXCJDdXN0b21FdmVudFwiKTtcclxuICAgICAgY3VzdG9tRXZlbnQuaW5pdEN1c3RvbUV2ZW50KHR5cGUsIGV2ZW50UGFyYW1zLmJ1YmJsZXMsIGV2ZW50UGFyYW1zLmNhbmNlbGFibGUsIGV2ZW50UGFyYW1zLmRldGFpbCk7XHJcbiAgICAgIHJldHVybiBjdXN0b21FdmVudDtcclxuICAgIH07XHJcbiAgICB2YXIgbWVkaXVtWm9vbSA9IGZ1bmN0aW9uIG1lZGl1bVpvb20oc2VsZWN0b3IpIHtcclxuICAgICAgdmFyIG9wdGlvbnMgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IHt9O1xyXG4gICAgICB2YXIgUHJvbWlzZSA9IHdpbmRvdy5Qcm9taXNlIHx8IGZ1bmN0aW9uIFByb21pc2UoZm4pIHtcclxuICAgICAgICBmdW5jdGlvbiBub29wKCkge31cclxuICAgICAgICBmbihub29wLCBub29wKTtcclxuICAgICAgfTtcclxuICAgICAgdmFyIF9oYW5kbGVDbGljayA9IGZ1bmN0aW9uIF9oYW5kbGVDbGljayhldmVudCkge1xyXG4gICAgICAgIHZhciB0YXJnZXQgPSBldmVudC50YXJnZXQ7XHJcbiAgICAgICAgaWYgKHRhcmdldCA9PT0gb3ZlcmxheSkge1xyXG4gICAgICAgICAgY2xvc2UoKTtcclxuICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGltYWdlcy5pbmRleE9mKHRhcmdldCkgPT09IC0xKSB7XHJcbiAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRvZ2dsZSh7XHJcbiAgICAgICAgICB0YXJnZXQ6IHRhcmdldFxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9O1xyXG4gICAgICB2YXIgX2hhbmRsZVNjcm9sbCA9IGZ1bmN0aW9uIF9oYW5kbGVTY3JvbGwoKSB7XHJcbiAgICAgICAgaWYgKGlzQW5pbWF0aW5nIHx8ICFhY3RpdmUub3JpZ2luYWwpIHtcclxuICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIGN1cnJlbnRTY3JvbGwgPSB3aW5kb3cucGFnZVlPZmZzZXQgfHwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFRvcCB8fCBkb2N1bWVudC5ib2R5LnNjcm9sbFRvcCB8fCAwO1xyXG4gICAgICAgIGlmIChNYXRoLmFicyhzY3JvbGxUb3AgLSBjdXJyZW50U2Nyb2xsKSA+IHpvb21PcHRpb25zLnNjcm9sbE9mZnNldCkge1xyXG4gICAgICAgICAgc2V0VGltZW91dChjbG9zZSwgMTUwKTtcclxuICAgICAgICB9XHJcbiAgICAgIH07XHJcbiAgICAgIHZhciBfaGFuZGxlS2V5VXAgPSBmdW5jdGlvbiBfaGFuZGxlS2V5VXAoZXZlbnQpIHtcclxuICAgICAgICBpZiAoKGV2ZW50LmtleUNvZGUgfHwgZXZlbnQud2hpY2gpID09PSAyNykge1xyXG4gICAgICAgICAgY2xvc2UoKTtcclxuICAgICAgICB9XHJcbiAgICAgIH07XHJcbiAgICAgIHZhciB1cGRhdGUgPSBmdW5jdGlvbiB1cGRhdGUoKSB7XHJcbiAgICAgICAgdmFyIG9wdGlvbnMgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IHt9O1xyXG4gICAgICAgIHZhciBuZXdPcHRpb25zID0gb3B0aW9ucztcclxuICAgICAgICBpZiAob3B0aW9ucy5iYWNrZ3JvdW5kKSB7XHJcbiAgICAgICAgICBvdmVybGF5LnN0eWxlLmJhY2tncm91bmQgPSBvcHRpb25zLmJhY2tncm91bmQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChvcHRpb25zLmNvbnRhaW5lciAmJiBvcHRpb25zLmNvbnRhaW5lciBpbnN0YW5jZW9mIE9iamVjdCkge1xyXG4gICAgICAgICAgbmV3T3B0aW9ucy5jb250YWluZXIgPSBfZXh0ZW5kcyh7fSwgem9vbU9wdGlvbnMuY29udGFpbmVyLCBvcHRpb25zLmNvbnRhaW5lcik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChvcHRpb25zLnRlbXBsYXRlKSB7XHJcbiAgICAgICAgICB2YXIgdGVtcGxhdGUgPSBpc05vZGUob3B0aW9ucy50ZW1wbGF0ZSkgPyBvcHRpb25zLnRlbXBsYXRlIDogZG9jdW1lbnQucXVlcnlTZWxlY3RvcihvcHRpb25zLnRlbXBsYXRlKTtcclxuICAgICAgICAgIG5ld09wdGlvbnMudGVtcGxhdGUgPSB0ZW1wbGF0ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgem9vbU9wdGlvbnMgPSBfZXh0ZW5kcyh7fSwgem9vbU9wdGlvbnMsIG5ld09wdGlvbnMpO1xyXG4gICAgICAgIGltYWdlcy5mb3JFYWNoKGZ1bmN0aW9uKGltYWdlKSB7XHJcbiAgICAgICAgICBpbWFnZS5kaXNwYXRjaEV2ZW50KGNyZWF0ZUN1c3RvbUV2ZW50KFwibWVkaXVtLXpvb206dXBkYXRlXCIsIHtcclxuICAgICAgICAgICAgZGV0YWlsOiB7XHJcbiAgICAgICAgICAgICAgem9vbTogem9vbVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9KSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIHpvb207XHJcbiAgICAgIH07XHJcbiAgICAgIHZhciBjbG9uZSA9IGZ1bmN0aW9uIGNsb25lKCkge1xyXG4gICAgICAgIHZhciBvcHRpb25zID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiB7fTtcclxuICAgICAgICByZXR1cm4gbWVkaXVtWm9vbShfZXh0ZW5kcyh7fSwgem9vbU9wdGlvbnMsIG9wdGlvbnMpKTtcclxuICAgICAgfTtcclxuICAgICAgdmFyIGF0dGFjaCA9IGZ1bmN0aW9uIGF0dGFjaCgpIHtcclxuICAgICAgICBmb3IgKHZhciBfbGVuID0gYXJndW1lbnRzLmxlbmd0aCwgc2VsZWN0b3JzID0gQXJyYXkoX2xlbiksIF9rZXkgPSAwOyBfa2V5IDwgX2xlbjsgX2tleSsrKSB7XHJcbiAgICAgICAgICBzZWxlY3RvcnNbX2tleV0gPSBhcmd1bWVudHNbX2tleV07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBuZXdJbWFnZXMgPSBzZWxlY3RvcnMucmVkdWNlKGZ1bmN0aW9uKGltYWdlc0FjY3VtdWxhdG9yLCBjdXJyZW50U2VsZWN0b3IpIHtcclxuICAgICAgICAgIHJldHVybiBbXS5jb25jYXQoaW1hZ2VzQWNjdW11bGF0b3IsIGdldEltYWdlc0Zyb21TZWxlY3RvcihjdXJyZW50U2VsZWN0b3IpKTtcclxuICAgICAgICB9LCBbXSk7XHJcbiAgICAgICAgbmV3SW1hZ2VzLmZpbHRlcihmdW5jdGlvbihuZXdJbWFnZSkge1xyXG4gICAgICAgICAgcmV0dXJuIGltYWdlcy5pbmRleE9mKG5ld0ltYWdlKSA9PT0gLTE7XHJcbiAgICAgICAgfSkuZm9yRWFjaChmdW5jdGlvbihuZXdJbWFnZSkge1xyXG4gICAgICAgICAgaW1hZ2VzLnB1c2gobmV3SW1hZ2UpO1xyXG4gICAgICAgICAgbmV3SW1hZ2UuY2xhc3NMaXN0LmFkZChcIm1lZGl1bS16b29tLWltYWdlXCIpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGV2ZW50TGlzdGVuZXJzLmZvckVhY2goZnVuY3Rpb24oX3JlZikge1xyXG4gICAgICAgICAgdmFyIHR5cGUgPSBfcmVmLnR5cGUsIGxpc3RlbmVyID0gX3JlZi5saXN0ZW5lciwgb3B0aW9ucyA9IF9yZWYub3B0aW9ucztcclxuICAgICAgICAgIG5ld0ltYWdlcy5mb3JFYWNoKGZ1bmN0aW9uKGltYWdlKSB7XHJcbiAgICAgICAgICAgIGltYWdlLmFkZEV2ZW50TGlzdGVuZXIodHlwZSwgbGlzdGVuZXIsIG9wdGlvbnMpO1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIHpvb207XHJcbiAgICAgIH07XHJcbiAgICAgIHZhciBkZXRhY2ggPSBmdW5jdGlvbiBkZXRhY2goKSB7XHJcbiAgICAgICAgZm9yICh2YXIgX2xlbjIgPSBhcmd1bWVudHMubGVuZ3RoLCBzZWxlY3RvcnMgPSBBcnJheShfbGVuMiksIF9rZXkyID0gMDsgX2tleTIgPCBfbGVuMjsgX2tleTIrKykge1xyXG4gICAgICAgICAgc2VsZWN0b3JzW19rZXkyXSA9IGFyZ3VtZW50c1tfa2V5Ml07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChhY3RpdmUuem9vbWVkKSB7XHJcbiAgICAgICAgICBjbG9zZSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgaW1hZ2VzVG9EZXRhY2ggPSBzZWxlY3RvcnMubGVuZ3RoID4gMCA/IHNlbGVjdG9ycy5yZWR1Y2UoZnVuY3Rpb24oaW1hZ2VzQWNjdW11bGF0b3IsIGN1cnJlbnRTZWxlY3Rvcikge1xyXG4gICAgICAgICAgcmV0dXJuIFtdLmNvbmNhdChpbWFnZXNBY2N1bXVsYXRvciwgZ2V0SW1hZ2VzRnJvbVNlbGVjdG9yKGN1cnJlbnRTZWxlY3RvcikpO1xyXG4gICAgICAgIH0sIFtdKSA6IGltYWdlcztcclxuICAgICAgICBpbWFnZXNUb0RldGFjaC5mb3JFYWNoKGZ1bmN0aW9uKGltYWdlKSB7XHJcbiAgICAgICAgICBpbWFnZS5jbGFzc0xpc3QucmVtb3ZlKFwibWVkaXVtLXpvb20taW1hZ2VcIik7XHJcbiAgICAgICAgICBpbWFnZS5kaXNwYXRjaEV2ZW50KGNyZWF0ZUN1c3RvbUV2ZW50KFwibWVkaXVtLXpvb206ZGV0YWNoXCIsIHtcclxuICAgICAgICAgICAgZGV0YWlsOiB7XHJcbiAgICAgICAgICAgICAgem9vbTogem9vbVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9KSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgaW1hZ2VzID0gaW1hZ2VzLmZpbHRlcihmdW5jdGlvbihpbWFnZSkge1xyXG4gICAgICAgICAgcmV0dXJuIGltYWdlc1RvRGV0YWNoLmluZGV4T2YoaW1hZ2UpID09PSAtMTtcclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gem9vbTtcclxuICAgICAgfTtcclxuICAgICAgdmFyIG9uID0gZnVuY3Rpb24gb24odHlwZSwgbGlzdGVuZXIpIHtcclxuICAgICAgICB2YXIgb3B0aW9ucyA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzJdIDoge307XHJcbiAgICAgICAgaW1hZ2VzLmZvckVhY2goZnVuY3Rpb24oaW1hZ2UpIHtcclxuICAgICAgICAgIGltYWdlLmFkZEV2ZW50TGlzdGVuZXIoXCJtZWRpdW0tem9vbTpcIiArIHR5cGUsIGxpc3RlbmVyLCBvcHRpb25zKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICBldmVudExpc3RlbmVycy5wdXNoKHtcclxuICAgICAgICAgIHR5cGU6IFwibWVkaXVtLXpvb206XCIgKyB0eXBlLFxyXG4gICAgICAgICAgbGlzdGVuZXI6IGxpc3RlbmVyLFxyXG4gICAgICAgICAgb3B0aW9uczogb3B0aW9uc1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiB6b29tO1xyXG4gICAgICB9O1xyXG4gICAgICB2YXIgb2ZmID0gZnVuY3Rpb24gb2ZmKHR5cGUsIGxpc3RlbmVyKSB7XHJcbiAgICAgICAgdmFyIG9wdGlvbnMgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6IHt9O1xyXG4gICAgICAgIGltYWdlcy5mb3JFYWNoKGZ1bmN0aW9uKGltYWdlKSB7XHJcbiAgICAgICAgICBpbWFnZS5yZW1vdmVFdmVudExpc3RlbmVyKFwibWVkaXVtLXpvb206XCIgKyB0eXBlLCBsaXN0ZW5lciwgb3B0aW9ucyk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgZXZlbnRMaXN0ZW5lcnMgPSBldmVudExpc3RlbmVycy5maWx0ZXIoZnVuY3Rpb24oZXZlbnRMaXN0ZW5lcikge1xyXG4gICAgICAgICAgcmV0dXJuICEoZXZlbnRMaXN0ZW5lci50eXBlID09PSBcIm1lZGl1bS16b29tOlwiICsgdHlwZSAmJiBldmVudExpc3RlbmVyLmxpc3RlbmVyLnRvU3RyaW5nKCkgPT09IGxpc3RlbmVyLnRvU3RyaW5nKCkpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiB6b29tO1xyXG4gICAgICB9O1xyXG4gICAgICB2YXIgb3BlbiA9IGZ1bmN0aW9uIG9wZW4oKSB7XHJcbiAgICAgICAgdmFyIF9yZWYyID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiB7fSwgdGFyZ2V0ID0gX3JlZjIudGFyZ2V0O1xyXG4gICAgICAgIHZhciBfYW5pbWF0ZSA9IGZ1bmN0aW9uIF9hbmltYXRlKCkge1xyXG4gICAgICAgICAgdmFyIGNvbnRhaW5lciA9IHtcclxuICAgICAgICAgICAgd2lkdGg6IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aCxcclxuICAgICAgICAgICAgaGVpZ2h0OiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0LFxyXG4gICAgICAgICAgICBsZWZ0OiAwLFxyXG4gICAgICAgICAgICB0b3A6IDAsXHJcbiAgICAgICAgICAgIHJpZ2h0OiAwLFxyXG4gICAgICAgICAgICBib3R0b206IDBcclxuICAgICAgICAgIH07XHJcbiAgICAgICAgICB2YXIgdmlld3BvcnRXaWR0aCA9IHZvaWQgMDtcclxuICAgICAgICAgIHZhciB2aWV3cG9ydEhlaWdodCA9IHZvaWQgMDtcclxuICAgICAgICAgIGlmICh6b29tT3B0aW9ucy5jb250YWluZXIpIHtcclxuICAgICAgICAgICAgaWYgKHpvb21PcHRpb25zLmNvbnRhaW5lciBpbnN0YW5jZW9mIE9iamVjdCkge1xyXG4gICAgICAgICAgICAgIGNvbnRhaW5lciA9IF9leHRlbmRzKHt9LCBjb250YWluZXIsIHpvb21PcHRpb25zLmNvbnRhaW5lcik7XHJcbiAgICAgICAgICAgICAgdmlld3BvcnRXaWR0aCA9IGNvbnRhaW5lci53aWR0aCAtIGNvbnRhaW5lci5sZWZ0IC0gY29udGFpbmVyLnJpZ2h0IC0gem9vbU9wdGlvbnMubWFyZ2luICogMjtcclxuICAgICAgICAgICAgICB2aWV3cG9ydEhlaWdodCA9IGNvbnRhaW5lci5oZWlnaHQgLSBjb250YWluZXIudG9wIC0gY29udGFpbmVyLmJvdHRvbSAtIHpvb21PcHRpb25zLm1hcmdpbiAqIDI7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgdmFyIHpvb21Db250YWluZXIgPSBpc05vZGUoem9vbU9wdGlvbnMuY29udGFpbmVyKSA/IHpvb21PcHRpb25zLmNvbnRhaW5lciA6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Ioem9vbU9wdGlvbnMuY29udGFpbmVyKTtcclxuICAgICAgICAgICAgICB2YXIgX3pvb21Db250YWluZXIkZ2V0Qm91ID0gem9vbUNvbnRhaW5lci5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSwgX3dpZHRoID0gX3pvb21Db250YWluZXIkZ2V0Qm91LndpZHRoLCBfaGVpZ2h0ID0gX3pvb21Db250YWluZXIkZ2V0Qm91LmhlaWdodCwgX2xlZnQgPSBfem9vbUNvbnRhaW5lciRnZXRCb3UubGVmdCwgX3RvcCA9IF96b29tQ29udGFpbmVyJGdldEJvdS50b3A7XHJcbiAgICAgICAgICAgICAgY29udGFpbmVyID0gX2V4dGVuZHMoe30sIGNvbnRhaW5lciwge1xyXG4gICAgICAgICAgICAgICAgd2lkdGg6IF93aWR0aCxcclxuICAgICAgICAgICAgICAgIGhlaWdodDogX2hlaWdodCxcclxuICAgICAgICAgICAgICAgIGxlZnQ6IF9sZWZ0LFxyXG4gICAgICAgICAgICAgICAgdG9wOiBfdG9wXHJcbiAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICAgIHZpZXdwb3J0V2lkdGggPSB2aWV3cG9ydFdpZHRoIHx8IGNvbnRhaW5lci53aWR0aCAtIHpvb21PcHRpb25zLm1hcmdpbiAqIDI7XHJcbiAgICAgICAgICB2aWV3cG9ydEhlaWdodCA9IHZpZXdwb3J0SGVpZ2h0IHx8IGNvbnRhaW5lci5oZWlnaHQgLSB6b29tT3B0aW9ucy5tYXJnaW4gKiAyO1xyXG4gICAgICAgICAgdmFyIHpvb21UYXJnZXQgPSBhY3RpdmUuem9vbWVkSGQgfHwgYWN0aXZlLm9yaWdpbmFsO1xyXG4gICAgICAgICAgdmFyIG5hdHVyYWxXaWR0aCA9IGlzU3ZnKHpvb21UYXJnZXQpID8gdmlld3BvcnRXaWR0aCA6IHpvb21UYXJnZXQubmF0dXJhbFdpZHRoIHx8IHZpZXdwb3J0V2lkdGg7XHJcbiAgICAgICAgICB2YXIgbmF0dXJhbEhlaWdodCA9IGlzU3ZnKHpvb21UYXJnZXQpID8gdmlld3BvcnRIZWlnaHQgOiB6b29tVGFyZ2V0Lm5hdHVyYWxIZWlnaHQgfHwgdmlld3BvcnRIZWlnaHQ7XHJcbiAgICAgICAgICB2YXIgX3pvb21UYXJnZXQkZ2V0Qm91bmRpID0gem9vbVRhcmdldC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSwgdG9wID0gX3pvb21UYXJnZXQkZ2V0Qm91bmRpLnRvcCwgbGVmdCA9IF96b29tVGFyZ2V0JGdldEJvdW5kaS5sZWZ0LCB3aWR0aCA9IF96b29tVGFyZ2V0JGdldEJvdW5kaS53aWR0aCwgaGVpZ2h0ID0gX3pvb21UYXJnZXQkZ2V0Qm91bmRpLmhlaWdodDtcclxuICAgICAgICAgIHZhciBzY2FsZVggPSBNYXRoLm1pbihuYXR1cmFsV2lkdGgsIHZpZXdwb3J0V2lkdGgpIC8gd2lkdGg7XHJcbiAgICAgICAgICB2YXIgc2NhbGVZID0gTWF0aC5taW4obmF0dXJhbEhlaWdodCwgdmlld3BvcnRIZWlnaHQpIC8gaGVpZ2h0O1xyXG4gICAgICAgICAgdmFyIHNjYWxlID0gTWF0aC5taW4oc2NhbGVYLCBzY2FsZVkpO1xyXG4gICAgICAgICAgdmFyIHRyYW5zbGF0ZVggPSAoLWxlZnQgKyAodmlld3BvcnRXaWR0aCAtIHdpZHRoKSAvIDIgKyB6b29tT3B0aW9ucy5tYXJnaW4gKyBjb250YWluZXIubGVmdCkgLyBzY2FsZTtcclxuICAgICAgICAgIHZhciB0cmFuc2xhdGVZID0gKC10b3AgKyAodmlld3BvcnRIZWlnaHQgLSBoZWlnaHQpIC8gMiArIHpvb21PcHRpb25zLm1hcmdpbiArIGNvbnRhaW5lci50b3ApIC8gc2NhbGU7XHJcbiAgICAgICAgICB2YXIgdHJhbnNmb3JtID0gXCJzY2FsZShcIiArIHNjYWxlICsgXCIpIHRyYW5zbGF0ZTNkKFwiICsgdHJhbnNsYXRlWCArIFwicHgsIFwiICsgdHJhbnNsYXRlWSArIFwicHgsIDApXCI7XHJcbiAgICAgICAgICBhY3RpdmUuem9vbWVkLnN0eWxlLnRyYW5zZm9ybSA9IHRyYW5zZm9ybTtcclxuICAgICAgICAgIGlmIChhY3RpdmUuem9vbWVkSGQpIHtcclxuICAgICAgICAgICAgYWN0aXZlLnpvb21lZEhkLnN0eWxlLnRyYW5zZm9ybSA9IHRyYW5zZm9ybTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlKSB7XHJcbiAgICAgICAgICBpZiAodGFyZ2V0ICYmIGltYWdlcy5pbmRleE9mKHRhcmdldCkgPT09IC0xKSB7XHJcbiAgICAgICAgICAgIHJlc29sdmUoem9vbSk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIHZhciBfaGFuZGxlT3BlbkVuZCA9IGZ1bmN0aW9uIF9oYW5kbGVPcGVuRW5kKCkge1xyXG4gICAgICAgICAgICBpc0FuaW1hdGluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICBhY3RpdmUuem9vbWVkLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJ0cmFuc2l0aW9uZW5kXCIsIF9oYW5kbGVPcGVuRW5kKTtcclxuICAgICAgICAgICAgYWN0aXZlLm9yaWdpbmFsLmRpc3BhdGNoRXZlbnQoY3JlYXRlQ3VzdG9tRXZlbnQoXCJtZWRpdW0tem9vbTpvcGVuZWRcIiwge1xyXG4gICAgICAgICAgICAgIGRldGFpbDoge1xyXG4gICAgICAgICAgICAgICAgem9vbTogem9vbVxyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSkpO1xyXG4gICAgICAgICAgICByZXNvbHZlKHpvb20pO1xyXG4gICAgICAgICAgfTtcclxuICAgICAgICAgIGlmIChhY3RpdmUuem9vbWVkKSB7XHJcbiAgICAgICAgICAgIHJlc29sdmUoem9vbSk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGlmICh0YXJnZXQpIHtcclxuICAgICAgICAgICAgYWN0aXZlLm9yaWdpbmFsID0gdGFyZ2V0O1xyXG4gICAgICAgICAgfSBlbHNlIGlmIChpbWFnZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICB2YXIgX2ltYWdlcyA9IGltYWdlcztcclxuICAgICAgICAgICAgYWN0aXZlLm9yaWdpbmFsID0gX2ltYWdlc1swXTtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJlc29sdmUoem9vbSk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGFjdGl2ZS5vcmlnaW5hbC5kaXNwYXRjaEV2ZW50KGNyZWF0ZUN1c3RvbUV2ZW50KFwibWVkaXVtLXpvb206b3BlblwiLCB7XHJcbiAgICAgICAgICAgIGRldGFpbDoge1xyXG4gICAgICAgICAgICAgIHpvb206IHpvb21cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSkpO1xyXG4gICAgICAgICAgc2Nyb2xsVG9wID0gd2luZG93LnBhZ2VZT2Zmc2V0IHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxUb3AgfHwgZG9jdW1lbnQuYm9keS5zY3JvbGxUb3AgfHwgMDtcclxuICAgICAgICAgIGlzQW5pbWF0aW5nID0gdHJ1ZTtcclxuICAgICAgICAgIGFjdGl2ZS56b29tZWQgPSBjbG9uZVRhcmdldChhY3RpdmUub3JpZ2luYWwpO1xyXG4gICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChvdmVybGF5KTtcclxuICAgICAgICAgIGlmICh6b29tT3B0aW9ucy50ZW1wbGF0ZSkge1xyXG4gICAgICAgICAgICB2YXIgdGVtcGxhdGUgPSBpc05vZGUoem9vbU9wdGlvbnMudGVtcGxhdGUpID8gem9vbU9wdGlvbnMudGVtcGxhdGUgOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHpvb21PcHRpb25zLnRlbXBsYXRlKTtcclxuICAgICAgICAgICAgYWN0aXZlLnRlbXBsYXRlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICAgICAgYWN0aXZlLnRlbXBsYXRlLmFwcGVuZENoaWxkKHRlbXBsYXRlLmNvbnRlbnQuY2xvbmVOb2RlKHRydWUpKTtcclxuICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChhY3RpdmUudGVtcGxhdGUpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChhY3RpdmUuem9vbWVkKTtcclxuICAgICAgICAgIHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LmFkZChcIm1lZGl1bS16b29tLS1vcGVuZWRcIik7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICAgIGFjdGl2ZS5vcmlnaW5hbC5jbGFzc0xpc3QuYWRkKFwibWVkaXVtLXpvb20taW1hZ2UtLWhpZGRlblwiKTtcclxuICAgICAgICAgIGFjdGl2ZS56b29tZWQuY2xhc3NMaXN0LmFkZChcIm1lZGl1bS16b29tLWltYWdlLS1vcGVuZWRcIik7XHJcbiAgICAgICAgICBhY3RpdmUuem9vbWVkLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBjbG9zZSk7XHJcbiAgICAgICAgICBhY3RpdmUuem9vbWVkLmFkZEV2ZW50TGlzdGVuZXIoXCJ0cmFuc2l0aW9uZW5kXCIsIF9oYW5kbGVPcGVuRW5kKTtcclxuICAgICAgICAgIGlmIChhY3RpdmUub3JpZ2luYWwuZ2V0QXR0cmlidXRlKFwiZGF0YS16b29tLXNyY1wiKSkge1xyXG4gICAgICAgICAgICBhY3RpdmUuem9vbWVkSGQgPSBhY3RpdmUuem9vbWVkLmNsb25lTm9kZSgpO1xyXG4gICAgICAgICAgICBhY3RpdmUuem9vbWVkSGQucmVtb3ZlQXR0cmlidXRlKFwic3Jjc2V0XCIpO1xyXG4gICAgICAgICAgICBhY3RpdmUuem9vbWVkSGQucmVtb3ZlQXR0cmlidXRlKFwic2l6ZXNcIik7XHJcbiAgICAgICAgICAgIGFjdGl2ZS56b29tZWRIZC5zcmMgPSBhY3RpdmUuem9vbWVkLmdldEF0dHJpYnV0ZShcImRhdGEtem9vbS1zcmNcIik7XHJcbiAgICAgICAgICAgIGFjdGl2ZS56b29tZWRIZC5vbmVycm9yID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgY2xlYXJJbnRlcnZhbChnZXRab29tVGFyZ2V0U2l6ZSk7XHJcbiAgICAgICAgICAgICAgY29uc29sZS53YXJuKFwiVW5hYmxlIHRvIHJlYWNoIHRoZSB6b29tIGltYWdlIHRhcmdldCBcIiArIGFjdGl2ZS56b29tZWRIZC5zcmMpO1xyXG4gICAgICAgICAgICAgIGFjdGl2ZS56b29tZWRIZCA9IG51bGw7XHJcbiAgICAgICAgICAgICAgX2FuaW1hdGUoKTtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgdmFyIGdldFpvb21UYXJnZXRTaXplID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgaWYgKGFjdGl2ZS56b29tZWRIZC5jb21wbGV0ZSkge1xyXG4gICAgICAgICAgICAgICAgY2xlYXJJbnRlcnZhbChnZXRab29tVGFyZ2V0U2l6ZSk7XHJcbiAgICAgICAgICAgICAgICBhY3RpdmUuem9vbWVkSGQuY2xhc3NMaXN0LmFkZChcIm1lZGl1bS16b29tLWltYWdlLS1vcGVuZWRcIik7XHJcbiAgICAgICAgICAgICAgICBhY3RpdmUuem9vbWVkSGQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGNsb3NlKTtcclxuICAgICAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoYWN0aXZlLnpvb21lZEhkKTtcclxuICAgICAgICAgICAgICAgIF9hbmltYXRlKCk7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LCAxMCk7XHJcbiAgICAgICAgICB9IGVsc2UgaWYgKGFjdGl2ZS5vcmlnaW5hbC5oYXNBdHRyaWJ1dGUoXCJzcmNzZXRcIikpIHtcclxuICAgICAgICAgICAgYWN0aXZlLnpvb21lZEhkID0gYWN0aXZlLnpvb21lZC5jbG9uZU5vZGUoKTtcclxuICAgICAgICAgICAgYWN0aXZlLnpvb21lZEhkLnJlbW92ZUF0dHJpYnV0ZShcInNpemVzXCIpO1xyXG4gICAgICAgICAgICB2YXIgbG9hZEV2ZW50TGlzdGVuZXIgPSBhY3RpdmUuem9vbWVkSGQuYWRkRXZlbnRMaXN0ZW5lcihcImxvYWRcIiwgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgYWN0aXZlLnpvb21lZEhkLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJsb2FkXCIsIGxvYWRFdmVudExpc3RlbmVyKTtcclxuICAgICAgICAgICAgICBhY3RpdmUuem9vbWVkSGQuY2xhc3NMaXN0LmFkZChcIm1lZGl1bS16b29tLWltYWdlLS1vcGVuZWRcIik7XHJcbiAgICAgICAgICAgICAgYWN0aXZlLnpvb21lZEhkLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBjbG9zZSk7XHJcbiAgICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChhY3RpdmUuem9vbWVkSGQpO1xyXG4gICAgICAgICAgICAgIF9hbmltYXRlKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgX2FuaW1hdGUoKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgfTtcclxuICAgICAgdmFyIGNsb3NlID0gZnVuY3Rpb24gY2xvc2UoKSB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUpIHtcclxuICAgICAgICAgIGlmIChpc0FuaW1hdGluZyB8fCAhYWN0aXZlLm9yaWdpbmFsKSB7XHJcbiAgICAgICAgICAgIHJlc29sdmUoem9vbSk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIHZhciBfaGFuZGxlQ2xvc2VFbmQgPSBmdW5jdGlvbiBfaGFuZGxlQ2xvc2VFbmQoKSB7XHJcbiAgICAgICAgICAgIGFjdGl2ZS5vcmlnaW5hbC5jbGFzc0xpc3QucmVtb3ZlKFwibWVkaXVtLXpvb20taW1hZ2UtLWhpZGRlblwiKTtcclxuICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChhY3RpdmUuem9vbWVkKTtcclxuICAgICAgICAgICAgaWYgKGFjdGl2ZS56b29tZWRIZCkge1xyXG4gICAgICAgICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQoYWN0aXZlLnpvb21lZEhkKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKG92ZXJsYXkpO1xyXG4gICAgICAgICAgICBhY3RpdmUuem9vbWVkLmNsYXNzTGlzdC5yZW1vdmUoXCJtZWRpdW0tem9vbS1pbWFnZS0tb3BlbmVkXCIpO1xyXG4gICAgICAgICAgICBpZiAoYWN0aXZlLnRlbXBsYXRlKSB7XHJcbiAgICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChhY3RpdmUudGVtcGxhdGUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlzQW5pbWF0aW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGFjdGl2ZS56b29tZWQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInRyYW5zaXRpb25lbmRcIiwgX2hhbmRsZUNsb3NlRW5kKTtcclxuICAgICAgICAgICAgYWN0aXZlLm9yaWdpbmFsLmRpc3BhdGNoRXZlbnQoY3JlYXRlQ3VzdG9tRXZlbnQoXCJtZWRpdW0tem9vbTpjbG9zZWRcIiwge1xyXG4gICAgICAgICAgICAgIGRldGFpbDoge1xyXG4gICAgICAgICAgICAgICAgem9vbTogem9vbVxyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSkpO1xyXG4gICAgICAgICAgICBhY3RpdmUub3JpZ2luYWwgPSBudWxsO1xyXG4gICAgICAgICAgICBhY3RpdmUuem9vbWVkID0gbnVsbDtcclxuICAgICAgICAgICAgYWN0aXZlLnpvb21lZEhkID0gbnVsbDtcclxuICAgICAgICAgICAgYWN0aXZlLnRlbXBsYXRlID0gbnVsbDtcclxuICAgICAgICAgICAgcmVzb2x2ZSh6b29tKTtcclxuICAgICAgICAgIH07XHJcbiAgICAgICAgICBpc0FuaW1hdGluZyA9IHRydWU7XHJcbiAgICAgICAgICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5yZW1vdmUoXCJtZWRpdW0tem9vbS0tb3BlbmVkXCIpO1xyXG4gICAgICAgICAgYWN0aXZlLnpvb21lZC5zdHlsZS50cmFuc2Zvcm0gPSBcIlwiO1xyXG4gICAgICAgICAgaWYgKGFjdGl2ZS56b29tZWRIZCkge1xyXG4gICAgICAgICAgICBhY3RpdmUuem9vbWVkSGQuc3R5bGUudHJhbnNmb3JtID0gXCJcIjtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGlmIChhY3RpdmUudGVtcGxhdGUpIHtcclxuICAgICAgICAgICAgYWN0aXZlLnRlbXBsYXRlLnN0eWxlLnRyYW5zaXRpb24gPSBcIm9wYWNpdHkgMTUwbXNcIjtcclxuICAgICAgICAgICAgYWN0aXZlLnRlbXBsYXRlLnN0eWxlLm9wYWNpdHkgPSAwO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgYWN0aXZlLm9yaWdpbmFsLmRpc3BhdGNoRXZlbnQoY3JlYXRlQ3VzdG9tRXZlbnQoXCJtZWRpdW0tem9vbTpjbG9zZVwiLCB7XHJcbiAgICAgICAgICAgIGRldGFpbDoge1xyXG4gICAgICAgICAgICAgIHpvb206IHpvb21cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSkpO1xyXG4gICAgICAgICAgYWN0aXZlLnpvb21lZC5hZGRFdmVudExpc3RlbmVyKFwidHJhbnNpdGlvbmVuZFwiLCBfaGFuZGxlQ2xvc2VFbmQpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9O1xyXG4gICAgICB2YXIgdG9nZ2xlID0gZnVuY3Rpb24gdG9nZ2xlKCkge1xyXG4gICAgICAgIHZhciBfcmVmMyA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDoge30sIHRhcmdldCA9IF9yZWYzLnRhcmdldDtcclxuICAgICAgICBpZiAoYWN0aXZlLm9yaWdpbmFsKSB7XHJcbiAgICAgICAgICByZXR1cm4gY2xvc2UoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIG9wZW4oe1xyXG4gICAgICAgICAgdGFyZ2V0OiB0YXJnZXRcclxuICAgICAgICB9KTtcclxuICAgICAgfTtcclxuICAgICAgdmFyIGdldE9wdGlvbnMgPSBmdW5jdGlvbiBnZXRPcHRpb25zKCkge1xyXG4gICAgICAgIHJldHVybiB6b29tT3B0aW9ucztcclxuICAgICAgfTtcclxuICAgICAgdmFyIGdldEltYWdlcyA9IGZ1bmN0aW9uIGdldEltYWdlcygpIHtcclxuICAgICAgICByZXR1cm4gaW1hZ2VzO1xyXG4gICAgICB9O1xyXG4gICAgICB2YXIgZ2V0Wm9vbWVkSW1hZ2UgPSBmdW5jdGlvbiBnZXRab29tZWRJbWFnZSgpIHtcclxuICAgICAgICByZXR1cm4gYWN0aXZlLm9yaWdpbmFsO1xyXG4gICAgICB9O1xyXG4gICAgICB2YXIgaW1hZ2VzID0gW107XHJcbiAgICAgIHZhciBldmVudExpc3RlbmVycyA9IFtdO1xyXG4gICAgICB2YXIgaXNBbmltYXRpbmcgPSBmYWxzZTtcclxuICAgICAgdmFyIHNjcm9sbFRvcCA9IDA7XHJcbiAgICAgIHZhciB6b29tT3B0aW9ucyA9IG9wdGlvbnM7XHJcbiAgICAgIHZhciBhY3RpdmUgPSB7XHJcbiAgICAgICAgb3JpZ2luYWw6IG51bGwsXHJcbiAgICAgICAgem9vbWVkOiBudWxsLFxyXG4gICAgICAgIHpvb21lZEhkOiBudWxsLFxyXG4gICAgICAgIHRlbXBsYXRlOiBudWxsXHJcbiAgICAgIH07XHJcbiAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoc2VsZWN0b3IpID09PSBcIltvYmplY3QgT2JqZWN0XVwiKSB7XHJcbiAgICAgICAgem9vbU9wdGlvbnMgPSBzZWxlY3RvcjtcclxuICAgICAgfSBlbHNlIGlmIChzZWxlY3RvciB8fCB0eXBlb2Ygc2VsZWN0b3IgPT09IFwic3RyaW5nXCIpIHtcclxuICAgICAgICBhdHRhY2goc2VsZWN0b3IpO1xyXG4gICAgICB9XHJcbiAgICAgIHpvb21PcHRpb25zID0gX2V4dGVuZHMoe1xyXG4gICAgICAgIG1hcmdpbjogMCxcclxuICAgICAgICBiYWNrZ3JvdW5kOiBcIiNmZmZcIixcclxuICAgICAgICBzY3JvbGxPZmZzZXQ6IDQwLFxyXG4gICAgICAgIGNvbnRhaW5lcjogbnVsbCxcclxuICAgICAgICB0ZW1wbGF0ZTogbnVsbFxyXG4gICAgICB9LCB6b29tT3B0aW9ucyk7XHJcbiAgICAgIHZhciBvdmVybGF5ID0gY3JlYXRlT3ZlcmxheSh6b29tT3B0aW9ucy5iYWNrZ3JvdW5kKTtcclxuICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIF9oYW5kbGVDbGljayk7XHJcbiAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXl1cFwiLCBfaGFuZGxlS2V5VXApO1xyXG4gICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwic2Nyb2xsXCIsIF9oYW5kbGVTY3JvbGwpO1xyXG4gICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcInJlc2l6ZVwiLCBjbG9zZSk7XHJcbiAgICAgIHZhciB6b29tID0ge1xyXG4gICAgICAgIG9wZW46IG9wZW4sXHJcbiAgICAgICAgY2xvc2U6IGNsb3NlLFxyXG4gICAgICAgIHRvZ2dsZTogdG9nZ2xlLFxyXG4gICAgICAgIHVwZGF0ZTogdXBkYXRlLFxyXG4gICAgICAgIGNsb25lOiBjbG9uZSxcclxuICAgICAgICBhdHRhY2g6IGF0dGFjaCxcclxuICAgICAgICBkZXRhY2g6IGRldGFjaCxcclxuICAgICAgICBvbjogb24sXHJcbiAgICAgICAgb2ZmOiBvZmYsXHJcbiAgICAgICAgZ2V0T3B0aW9uczogZ2V0T3B0aW9ucyxcclxuICAgICAgICBnZXRJbWFnZXM6IGdldEltYWdlcyxcclxuICAgICAgICBnZXRab29tZWRJbWFnZTogZ2V0Wm9vbWVkSW1hZ2VcclxuICAgICAgfTtcclxuICAgICAgcmV0dXJuIHpvb207XHJcbiAgICB9O1xyXG4gICAgZnVuY3Rpb24gc3R5bGVJbmplY3QoY3NzLCByZWYpIHtcclxuICAgICAgaWYgKHJlZiA9PT0gdm9pZCAwKSByZWYgPSB7fTtcclxuICAgICAgdmFyIGluc2VydEF0ID0gcmVmLmluc2VydEF0O1xyXG4gICAgICBpZiAoIWNzcyB8fCB0eXBlb2YgZG9jdW1lbnQgPT09IFwidW5kZWZpbmVkXCIpIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuICAgICAgdmFyIGhlYWQgPSBkb2N1bWVudC5oZWFkIHx8IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKFwiaGVhZFwiKVswXTtcclxuICAgICAgdmFyIHN0eWxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInN0eWxlXCIpO1xyXG4gICAgICBzdHlsZS50eXBlID0gXCJ0ZXh0L2Nzc1wiO1xyXG4gICAgICBpZiAoaW5zZXJ0QXQgPT09IFwidG9wXCIpIHtcclxuICAgICAgICBpZiAoaGVhZC5maXJzdENoaWxkKSB7XHJcbiAgICAgICAgICBoZWFkLmluc2VydEJlZm9yZShzdHlsZSwgaGVhZC5maXJzdENoaWxkKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgaGVhZC5hcHBlbmRDaGlsZChzdHlsZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGhlYWQuYXBwZW5kQ2hpbGQoc3R5bGUpO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChzdHlsZS5zdHlsZVNoZWV0KSB7XHJcbiAgICAgICAgc3R5bGUuc3R5bGVTaGVldC5jc3NUZXh0ID0gY3NzO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHN0eWxlLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGNzcykpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICB2YXIgY3NzID0gXCIubWVkaXVtLXpvb20tb3ZlcmxheXtwb3NpdGlvbjpmaXhlZDt0b3A6MDtyaWdodDowO2JvdHRvbTowO2xlZnQ6MDtvcGFjaXR5OjA7dHJhbnNpdGlvbjpvcGFjaXR5IC4zczt3aWxsLWNoYW5nZTpvcGFjaXR5fS5tZWRpdW0tem9vbS0tb3BlbmVkIC5tZWRpdW0tem9vbS1vdmVybGF5e2N1cnNvcjpwb2ludGVyO2N1cnNvcjp6b29tLW91dDtvcGFjaXR5OjF9Lm1lZGl1bS16b29tLWltYWdle2N1cnNvcjpwb2ludGVyO2N1cnNvcjp6b29tLWluO3RyYW5zaXRpb246dHJhbnNmb3JtIC4zcyBjdWJpYy1iZXppZXIoLjIsMCwuMiwxKX0ubWVkaXVtLXpvb20taW1hZ2UtLWhpZGRlbnt2aXNpYmlsaXR5OmhpZGRlbn0ubWVkaXVtLXpvb20taW1hZ2UtLW9wZW5lZHtwb3NpdGlvbjpyZWxhdGl2ZTtjdXJzb3I6cG9pbnRlcjtjdXJzb3I6em9vbS1vdXQ7d2lsbC1jaGFuZ2U6dHJhbnNmb3JtfVwiO1xyXG4gICAgc3R5bGVJbmplY3QoY3NzKTtcclxuICAgIHJldHVybiBtZWRpdW1ab29tO1xyXG4gIH0pOyJdfQ==
